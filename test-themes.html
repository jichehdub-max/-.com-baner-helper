<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITD Themes Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® ITD Themes Extension Test</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ITD Themes.</p>
        
        <div class="test-section">
            <h3>–°—Ç–∞—Ç—É—Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è</h3>
            <div id="extensionStatus" class="status warning">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
            <button onclick="checkExtension()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ</button>
            <button onclick="forceLoadPanel()">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞–Ω–µ–ª—å</button>
        </div>
        
        <div class="test-section">
            <h3>–¢–µ—Å—Ç —Ç–µ–º</h3>
            <button onclick="testTheme('blue')">Blue Theme</button>
            <button onclick="testTheme('purple')">Purple Theme</button>
            <button onclick="testTheme('default')">Default Theme</button>
            <div id="themeStatus" class="status">–¢–µ–º–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞</div>
        </div>
        
        <div class="test-section">
            <h3>–¢–µ—Å—Ç —à–µ–π–¥–µ—Ä–æ–≤</h3>
            <button onclick="testShader()">–¢–µ—Å—Ç Plasma —à–µ–π–¥–µ—Ä–∞</button>
            <button onclick="clearShader()">–û—á–∏—Å—Ç–∏—Ç—å —à–µ–π–¥–µ—Ä</button>
            <div id="shaderStatus" class="status">–®–µ–π–¥–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω</div>
        </div>
        
        <div class="test-section">
            <h3>–õ–æ–≥–∏</h3>
            <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            <button onclick="copyLogs()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä</button>
            <div id="logs" class="log">–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
        </div>
    </div>

    <script>
        let logs = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            logs.push(logMessage);
            console.log(logMessage);
            updateLogsDisplay();
        }
        
        function updateLogsDisplay() {
            const logsDiv = document.getElementById('logs');
            logsDiv.innerHTML = logs.join('\n');
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        function clearLogs() {
            logs = [];
            updateLogsDisplay();
        }
        
        function copyLogs() {
            navigator.clipboard.writeText(logs.join('\n')).then(() => {
                log('–õ–æ–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
            });
        }
        
        function updateStatus(elementId, message, type = 'warning') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        function checkExtension() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è...');
            
            // Check if panel is loaded
            const panelLoaded = !!window.__itdThemePanelLoaded;
            const buttonExists = !!document.getElementById('itd-theme-btn');
            const panelExists = !!document.getElementById('itd-theme-panel');
            
            log(`Panel loaded: ${panelLoaded}`);
            log(`Button exists: ${buttonExists}`);
            log(`Panel exists: ${panelExists}`);
            
            if (panelLoaded && buttonExists) {
                updateStatus('extensionStatus', '‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ö–Ω–æ–ø–∫–∞ üé® –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∏–¥–Ω–∞', 'success');
            } else if (panelLoaded) {
                updateStatus('extensionStatus', '‚ö†Ô∏è –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ UI –Ω–µ —Å–æ–∑–¥–∞–Ω', 'warning');
            } else {
                updateStatus('extensionStatus', '‚ùå –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ', 'error');
            }
        }
        
        function forceLoadPanel() {
            log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞–Ω–µ–ª–∏...');
            
            // This would normally be done by the popup, but we can simulate it
            updateStatus('extensionStatus', '‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞–Ω–µ–ª—å" –≤ popup —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è', 'warning');
        }
        
        function testTheme(theme) {
            log(`–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã: ${theme}`);
            
            // Apply theme directly
            document.documentElement.setAttribute('data-itd-custom-theme', theme);
            updateStatus('themeStatus', `‚úÖ –¢–µ–º–∞ ${theme} –ø—Ä–∏–º–µ–Ω–µ–Ω–∞`, 'success');
            
            // Test CSS variables
            const computedStyle = getComputedStyle(document.documentElement);
            log(`CSS variables applied for theme: ${theme}`);
        }
        
        function testShader() {
            log('–¢–µ—Å—Ç —à–µ–π–¥–µ—Ä–∞...');
            
            // Check if shader canvas exists
            const existingCanvas = document.getElementById('itd-shader-canvas');
            if (existingCanvas) {
                log('–®–µ–π–¥–µ—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω');
                updateStatus('shaderStatus', '‚úÖ –®–µ–π–¥–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω', 'success');
                return;
            }
            
            // Create test shader canvas
            const canvas = document.createElement('canvas');
            canvas.id = 'itd-shader-canvas';
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                z-index: 999997 !important;
                pointer-events: none !important;
                opacity: 0.3 !important;
                mix-blend-mode: screen !important;
            `;
            
            document.body.appendChild(canvas);
            
            // Simple test pattern
            const ctx = canvas.getContext('2d');
            if (ctx) {
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, 'rgba(255, 0, 255, 0.3)');
                gradient.addColorStop(1, 'rgba(0, 255, 255, 0.3)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                updateStatus('shaderStatus', '‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —à–µ–π–¥–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω', 'success');
                log('–¢–µ—Å—Ç–æ–≤—ã–π —à–µ–π–¥–µ—Ä —Å–æ–∑–¥–∞–Ω');
            }
        }
        
        function clearShader() {
            const canvas = document.getElementById('itd-shader-canvas');
            if (canvas) {
                canvas.remove();
                updateStatus('shaderStatus', '–®–µ–π–¥–µ—Ä –æ—á–∏—â–µ–Ω', 'warning');
                log('–®–µ–π–¥–µ—Ä –æ—á–∏—â–µ–Ω');
            } else {
                log('–®–µ–π–¥–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(checkExtension, 1000);
        });
        
        // Listen for extension messages
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'ITD_PANEL_STATUS') {
                log(`–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: ${JSON.stringify(event.data)}`);
            }
        });
    </script>
</body>
</html>